<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.14.0" xml:lang="en-US">
  <compounddef id="nvs__manager_8c" kind="file" language="C++">
    <compoundname>nvs_manager.c</compoundname>
    <includes local="yes">nvs_flash.h</includes>
    <includes local="yes">nvs.h</includes>
    <includes local="yes">esp_log.h</includes>
    <includes refid="nvs__manager_8h" local="yes">nvs_manager.h</includes>
    <includes refid="system_8h" local="yes">system.h</includes>
    <incdepgraph>
      <node id="11">
        <label>ethernet.h</label>
        <link refid="ethernet_8h"/>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
      </node>
      <node id="5">
        <label>nvs_manager.h</label>
        <link refid="nvs__manager_8h"/>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="8">
        <label>sensors.h</label>
        <link refid="sensors_8h"/>
        <childnode refid="9" relation="include">
        </childnode>
      </node>
      <node id="7">
        <label>system.h</label>
        <link refid="system_8h"/>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
      </node>
      <node id="1">
        <label>C:/Users/Hammurabi.Sierra/Documents/GIT/AERtronic_Lite_2.0/ESP-IDF/Aertronic_Lite/main/nvs_manager.c</label>
        <link refid="nvs__manager_8c"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
      </node>
      <node id="9">
        <label>esp_err.h</label>
      </node>
      <node id="12">
        <label>esp_eth.h</label>
      </node>
      <node id="14">
        <label>esp_event.h</label>
      </node>
      <node id="4">
        <label>esp_log.h</label>
      </node>
      <node id="13">
        <label>esp_netif.h</label>
      </node>
      <node id="3">
        <label>nvs.h</label>
      </node>
      <node id="2">
        <label>nvs_flash.h</label>
      </node>
      <node id="10">
        <label>stdbool.h</label>
      </node>
      <node id="6">
        <label>stdint.h</label>
      </node>
    </incdepgraph>
    <sectiondef kind="define">
      <memberdef kind="define" id="nvs__manager_8c_1afc3d101f633a076cc1ca84b85b6224b2" prot="public" static="no">
        <name>TAG</name>
        <initializer>&quot;NVS_MANAGER&quot;</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/Users/Hammurabi.Sierra/Documents/GIT/AERtronic_Lite_2.0/ESP-IDF/Aertronic_Lite/main/nvs_manager.c" line="8" column="9" bodyfile="C:/Users/Hammurabi.Sierra/Documents/GIT/AERtronic_Lite_2.0/ESP-IDF/Aertronic_Lite/main/nvs_manager.c" bodystart="8" bodyend="-1"/>
        <referencedby refid="ethernet_8h_1a2ae9912b161cb0e12abb084e5d2756c2" compoundref="ethernet_8c" startline="22" endline="46">ethernet_event_handler</referencedby>
        <referencedby refid="ethernet_8h_1ac5a294a0efbd42bd9671903a60e4f52b" compoundref="ethernet_8c" startline="63" endline="125">ethernet_init</referencedby>
        <referencedby refid="tasks_8h_1a5dc1efd0c548644645cf4607e8e01ae0" compoundref="tasks_8c" startline="128" endline="152">ethernet_monitor_task</referencedby>
        <referencedby refid="ethernet_8h_1a864a2ddf998b216a85c97c640b841501" compoundref="ethernet_8c" startline="171" endline="203">ethernet_set_static_ip</referencedby>
        <referencedby refid="ethernet_8h_1a4f763d2ae63ab35e404488c1add5c852" compoundref="ethernet_8c" startline="127" endline="136">ethernet_start</referencedby>
        <referencedby refid="ethernet_8h_1a4039eaf3762551e4c7b70c07a8abe1a4" compoundref="ethernet_8c" startline="138" endline="148">ethernet_stop</referencedby>
        <referencedby refid="ethernet_8c_1a00e93e9c4cda2c8a6aac16b5bc195a09" compoundref="ethernet_8c" startline="48" endline="61">got_ip_event_handler</referencedby>
        <referencedby refid="nvs__manager_8h_1a77336aed281bafc61cdc6ecfc8572d15" compoundref="nvs__manager_8c" startline="12" endline="82">init_nvs_manager</referencedby>
      </memberdef>
    </sectiondef>
    <sectiondef kind="func">
      <memberdef kind="function" id="nvs__manager_8c_1a77336aed281bafc61cdc6ecfc8572d15" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void init_nvs_manager</definition>
        <argsstring>()</argsstring>
        <name>init_nvs_manager</name>
        <briefdescription>
<para>Initializes the NVS (Non-Volatile Storage). </para>
        </briefdescription>
        <detaileddescription>
<para>This function initializes the NVS system, allowing for data storage and retrieval. <simplesect kind="note"><para>This function should be called before using any NVS functions. </para>
</simplesect>
<simplesect kind="author"><para>Ernesto Estrada </para>
</simplesect>
<simplesect kind="date"><para>May 5, 2025 </para>
</simplesect>
<simplesect kind="version"><para>1.0 </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/Users/Hammurabi.Sierra/Documents/GIT/AERtronic_Lite_2.0/ESP-IDF/Aertronic_Lite/main/nvs_manager.c" line="12" column="6" bodyfile="C:/Users/Hammurabi.Sierra/Documents/GIT/AERtronic_Lite_2.0/ESP-IDF/Aertronic_Lite/main/nvs_manager.c" bodystart="12" bodyend="82"/>
        <references refid="system_8h_1aae68550ad38d9fd2a74d96a4f6efdc54" compoundref="system_8c" startline="17">boot_count</references>
        <references refid="nvs__manager_8h_1a1f7972830cca2ec9a7d9c9b08c3f4e01" compoundref="nvs__manager_8h" startline="13">KEY_BOOT_COUNTER</references>
        <references refid="nvs__manager_8h_1a4bda739bd43d6cbc49f5a4445bfab66b" compoundref="nvs__manager_8h" startline="17">KEY_MAINTENANCE_HOURS</references>
        <references refid="nvs__manager_8h_1a12e0ec2872971263a8238f0b699bc548" compoundref="nvs__manager_8h" startline="16">KEY_MAINTENANCE_MIN</references>
        <references refid="nvs__manager_8h_1aea21083fbc81f818313e73efcfb49a74" compoundref="nvs__manager_8h" startline="18">KEY_NUMBER_OF_MAINTENANCES</references>
        <references refid="nvs__manager_8h_1a1e101c783a22c7da1755d3150cbb793a" compoundref="nvs__manager_8h" startline="10">KEY_NVS_INIT</references>
        <references refid="nvs__manager_8h_1a865b7bdd57f5ed2e21d6db5fb2e807c5" compoundref="nvs__manager_8h" startline="12">KEY_OP_HOURS</references>
        <references refid="nvs__manager_8h_1af7f392a5d16adbd68edd97898cb9d268" compoundref="nvs__manager_8h" startline="11">KEY_OP_MIN</references>
        <references refid="nvs__manager_8h_1a67c7496c74bd4666922f2dba06477fa9" compoundref="nvs__manager_8h" startline="15">KEY_SYS_COLOR</references>
        <references refid="nvs__manager_8h_1a46fcc98b6ef274ff52db0243d4c85b83" compoundref="nvs__manager_8h" startline="14">KEY_SYS_LANGUAGE</references>
        <references refid="system_8h_1a7935be2326bd362ec59592d133232a12" compoundref="system_8c" startline="21">maintenance_hours</references>
        <references refid="system_8h_1a792282433d9feffdd90742acc4b7cf84" compoundref="system_8c" startline="20">maintenance_minutes</references>
        <references refid="nvs__manager_8h_1afa7779fe56b160955b535cd6a8aaf8f4" compoundref="nvs__manager_8h" startline="7">NAMESPACE</references>
        <references refid="system_8h_1aa828b108037b528aa15a5dc2bbf20195" compoundref="system_8c" startline="22">number_of_maintenances</references>
        <references refid="system_8h_1afefba2969f86ee117cf53a6709050a21" compoundref="system_8c" startline="16">operation_hours</references>
        <references refid="system_8h_1a2ef5919214974cb155ce0f62aec2c46f" compoundref="system_8c" startline="15">operation_minutes</references>
        <references refid="system_8h_1a30436bd24c155c7ff8b58f89cc4907d9" compoundref="system_8c" startline="19">system_color</references>
        <references refid="system_8h_1a10a3fa33bae024190264a8321128a41d" compoundref="system_8c" startline="18">system_language</references>
        <references refid="nvs__manager_8c_1afc3d101f633a076cc1ca84b85b6224b2" compoundref="nvs__manager_8c" startline="8">TAG</references>
        <referencedby refid="setup_8h_1aa2c353c6e3271404cdf45ce4601951c7" compoundref="setup_8c" startline="36" endline="44">init_nvs</referencedby>
      </memberdef>
      <memberdef kind="function" id="nvs__manager_8c_1aaec9f002eed7b2794c9babcfa7d3f50b" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void save_int_to_nvs</definition>
        <argsstring>(const char *key, int32_t value)</argsstring>
        <name>save_int_to_nvs</name>
        <param>
          <type>const char *</type>
          <declname>key</declname>
        </param>
        <param>
          <type>int32_t</type>
          <declname>value</declname>
        </param>
        <briefdescription>
<para>Loads an integer value from NVS using the specified key. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>key</parametername>
</parameternamelist>
<parameterdescription>
<para>The key associated with the integer value in NVS. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>value</parametername>
</parameternamelist>
<parameterdescription>
<para>int32_t variable to store the loaded value.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
This function does not return a value. Instead, it updates the global variable associated with the key. <simplesect kind="note"><para>Make sure that all keys used in this function are defined in the NVS namespace. </para>
</simplesect>
<simplesect kind="author"><para>Ernesto Estrada </para>
</simplesect>
<simplesect kind="date"><para>June 16, 2025 </para>
</simplesect>
<simplesect kind="version"><para>1.0 </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/Users/Hammurabi.Sierra/Documents/GIT/AERtronic_Lite_2.0/ESP-IDF/Aertronic_Lite/main/nvs_manager.c" line="84" column="6" bodyfile="C:/Users/Hammurabi.Sierra/Documents/GIT/AERtronic_Lite_2.0/ESP-IDF/Aertronic_Lite/main/nvs_manager.c" bodystart="84" bodyend="96"/>
        <references refid="nvs__manager_8h_1afa7779fe56b160955b535cd6a8aaf8f4" compoundref="nvs__manager_8h" startline="7">NAMESPACE</references>
        <referencedby refid="system_8h_1a3f45cb82b07f9844b825d73f091413a7" compoundref="system_8c" startline="56" endline="79">operation_time</referencedby>
        <referencedby refid="serial__receive_8h_1a09a926c2654b02052b2286a68b5ac51a" compoundref="serial__receive_8c" startline="58" endline="674">received_data</referencedby>
      </memberdef>
    </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="preprocessor">#include<sp/>&quot;nvs_flash.h&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="comment">//<sp/>Provides<sp/>functions<sp/>for<sp/>initializing<sp/>and<sp/>managing<sp/>non-volatile<sp/>storage<sp/>(NVS)<sp/>in<sp/>ESP32</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;nvs.h&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="comment">//<sp/>Provides<sp/>read/write<sp/>functions<sp/>for<sp/>key-value<sp/>storage</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;esp_log.h&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="comment">//<sp/>Logging<sp/>macros<sp/>(ESP_LOGI,<sp/>ESP_LOGE,<sp/>etc.)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="nvs__manager_8h" kindref="compound">nvs_manager.h</ref>&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="comment">//<sp/>Corresponding<sp/>header<sp/>file</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="system_8h" kindref="compound">system.h</ref>&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="comment">//<sp/>Gives<sp/>access<sp/>to<sp/>extern<sp/>variables<sp/>to<sp/>hold<sp/>data<sp/>stored<sp/>in<sp/>NVS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Define<sp/>a<sp/>tag<sp/>for<sp/>ESP_LOG<sp/>macros</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8" refid="nvs__manager_8c_1afc3d101f633a076cc1ca84b85b6224b2" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>TAG<sp/>&quot;NVS_MANAGER&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Initializes<sp/>NVS<sp/>and<sp/>loads<sp/>preferences.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="comment">//<sp/>If<sp/>this<sp/>is<sp/>the<sp/>first<sp/>boot,<sp/>it<sp/>initializes<sp/>default<sp/>values<sp/>and<sp/>stores<sp/>them.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12" refid="nvs__manager_8h_1a77336aed281bafc61cdc6ecfc8572d15" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="nvs__manager_8c_1a77336aed281bafc61cdc6ecfc8572d15" kindref="member">init_nvs_manager</ref>()<sp/>{</highlight></codeline>
<codeline lineno="13"><highlight class="normal"><sp/><sp/><sp/><sp/>esp_err_t<sp/>err;<sp/></highlight><highlight class="comment">//<sp/>Variable<sp/>to<sp/>hold<sp/>the<sp/>error<sp/>code</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"><sp/><sp/><sp/><sp/>nvs_handle_t<sp/>nvs_handle;<sp/></highlight><highlight class="comment">//<sp/>Handle<sp/>for<sp/>the<sp/>NVS<sp/>namespace</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"><sp/><sp/><sp/><sp/>uint8_t<sp/>nvs_init<sp/>=<sp/>0;<sp/></highlight><highlight class="comment">//<sp/>Variable<sp/>to<sp/>check<sp/>if<sp/>NVS<sp/>has<sp/>been<sp/>initialized</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Try<sp/>to<sp/>open<sp/>the<sp/>namespace<sp/>in<sp/>read-only<sp/>mode<sp/>to<sp/>check<sp/>if<sp/>it<sp/>exists</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"><sp/><sp/><sp/><sp/>err<sp/>=<sp/>nvs_open(<ref refid="nvs__manager_8h_1afa7779fe56b160955b535cd6a8aaf8f4" kindref="member">NAMESPACE</ref>,<sp/>NVS_READONLY,<sp/>&amp;nvs_handle);</highlight></codeline>
<codeline lineno="19"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(err<sp/>==<sp/>ESP_ERR_NVS_NOT_FOUND)<sp/>{</highlight></codeline>
<codeline lineno="20"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Namespace<sp/>doesn&apos;t<sp/>exist<sp/>â€”<sp/>it&apos;s<sp/>likely<sp/>a<sp/>first-time<sp/>boot</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGW(<ref refid="nvs__manager_8c_1afc3d101f633a076cc1ca84b85b6224b2" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Namespace<sp/>not<sp/>found,<sp/>proceeding<sp/>with<sp/>first-time<sp/>initialization&quot;</highlight><highlight class="normal">);<sp/></highlight><highlight class="comment">//<sp/>Log<sp/>a<sp/>warning</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(err<sp/>!=<sp/>ESP_OK)<sp/>{</highlight></codeline>
<codeline lineno="23"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>there<sp/>was<sp/>an<sp/>error<sp/>opening<sp/>the<sp/>namespace,<sp/>log<sp/>it<sp/>and<sp/>return</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGE(<ref refid="nvs__manager_8c_1afc3d101f633a076cc1ca84b85b6224b2" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Error<sp/>opening<sp/>NVS<sp/>namespace<sp/>in<sp/>RO<sp/>mode:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>esp_err_to_name(err));</highlight></codeline>
<codeline lineno="25"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="27"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Namespace<sp/>exists,<sp/>check<sp/>if<sp/>it<sp/>was<sp/>already<sp/>initialized</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/>nvs_get_u8(nvs_handle,<sp/><ref refid="nvs__manager_8h_1a1e101c783a22c7da1755d3150cbb793a" kindref="member">KEY_NVS_INIT</ref>,<sp/>&amp;nvs_init);<sp/></highlight><highlight class="comment">//<sp/>Try<sp/>to<sp/>get<sp/>the<sp/>initialization<sp/>flag</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nvs_close(nvs_handle);<sp/></highlight><highlight class="comment">//<sp/>Always<sp/>close<sp/>the<sp/>handle<sp/>after<sp/>use</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>nvsInit<sp/>!=<sp/>1,<sp/>it&apos;s<sp/>a<sp/>first-time<sp/>setup</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(nvs_init<sp/>!=<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Open<sp/>the<sp/>namespace<sp/>in<sp/>read-write<sp/>mode<sp/>to<sp/>write<sp/>default<sp/>values</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/>nvs_open(<ref refid="nvs__manager_8h_1afa7779fe56b160955b535cd6a8aaf8f4" kindref="member">NAMESPACE</ref>,<sp/>NVS_READWRITE,<sp/>&amp;nvs_handle);</highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(err<sp/>!=<sp/>ESP_OK)<sp/>{</highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGE(<ref refid="nvs__manager_8c_1afc3d101f633a076cc1ca84b85b6224b2" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>open<sp/>NVS<sp/>in<sp/>RW<sp/>mode:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>esp_err_to_name(err));<sp/></highlight><highlight class="comment">//<sp/>Log<sp/>the<sp/>error</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;<sp/></highlight><highlight class="comment">//<sp/>Exit<sp/>if<sp/>we<sp/>can&apos;t<sp/>open<sp/>the<sp/>namespace</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Write<sp/>default<sp/>values<sp/>to<sp/>NVS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nvs_set_i32(nvs_handle,<sp/><ref refid="nvs__manager_8h_1af7f392a5d16adbd68edd97898cb9d268" kindref="member">KEY_OP_MIN</ref>,<sp/>0);<sp/></highlight><highlight class="comment">//<sp/>Set<sp/>operation<sp/>minutes<sp/>to<sp/>0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nvs_set_i32(nvs_handle,<sp/><ref refid="nvs__manager_8h_1a865b7bdd57f5ed2e21d6db5fb2e807c5" kindref="member">KEY_OP_HOURS</ref>,<sp/>0);<sp/></highlight><highlight class="comment">//<sp/>Set<sp/>operation<sp/>hours<sp/>to<sp/>0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nvs_set_i32(nvs_handle,<sp/><ref refid="nvs__manager_8h_1a1f7972830cca2ec9a7d9c9b08c3f4e01" kindref="member">KEY_BOOT_COUNTER</ref>,<sp/>0);<sp/></highlight><highlight class="comment">//<sp/>Set<sp/>boot<sp/>count<sp/>to<sp/>0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nvs_set_i32(nvs_handle,<sp/><ref refid="nvs__manager_8h_1a46fcc98b6ef274ff52db0243d4c85b83" kindref="member">KEY_SYS_LANGUAGE</ref>,<sp/>0);<sp/></highlight><highlight class="comment">//<sp/>Set<sp/>system<sp/>language<sp/>to<sp/>default<sp/>(0)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nvs_set_i32(nvs_handle,<sp/><ref refid="nvs__manager_8h_1a67c7496c74bd4666922f2dba06477fa9" kindref="member">KEY_SYS_COLOR</ref>,<sp/>0);<sp/></highlight><highlight class="comment">//<sp/>Set<sp/>system<sp/>color<sp/>to<sp/>default<sp/>(0)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nvs_set_i32(nvs_handle,<sp/><ref refid="nvs__manager_8h_1a12e0ec2872971263a8238f0b699bc548" kindref="member">KEY_MAINTENANCE_MIN</ref>,<sp/>0);<sp/></highlight><highlight class="comment">//<sp/>Set<sp/>maintenance<sp/>minutes<sp/>to<sp/>0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nvs_set_i32(nvs_handle,<sp/><ref refid="nvs__manager_8h_1a4bda739bd43d6cbc49f5a4445bfab66b" kindref="member">KEY_MAINTENANCE_HOURS</ref>,<sp/>0);<sp/></highlight><highlight class="comment">//<sp/>Set<sp/>maintenence<sp/>hours<sp/>to<sp/>0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nvs_set_i32(nvs_handle,<sp/><ref refid="nvs__manager_8h_1aea21083fbc81f818313e73efcfb49a74" kindref="member">KEY_NUMBER_OF_MAINTENANCES</ref>,<sp/>0);<sp/></highlight><highlight class="comment">//<sp/>Set<sp/>number<sp/>of<sp/>maintenances<sp/>to<sp/>0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="50"><highlight class="normal"></highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Mark<sp/>the<sp/>NVS<sp/>as<sp/>initialized</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nvs_set_u8(nvs_handle,<sp/><ref refid="nvs__manager_8h_1a1e101c783a22c7da1755d3150cbb793a" kindref="member">KEY_NVS_INIT</ref>,<sp/>1);<sp/></highlight><highlight class="comment">//<sp/>Set<sp/>the<sp/>initialization<sp/>flag<sp/>to<sp/>1<sp/>indicating<sp/>NVS<sp/>is<sp/>initialized</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="53"><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Save<sp/>all<sp/>changes<sp/>to<sp/>flash</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nvs_commit(nvs_handle);<sp/></highlight><highlight class="comment">//<sp/>Commit<sp/>the<sp/>changes<sp/>to<sp/>NVS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Close<sp/>the<sp/>NVS<sp/>handle</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nvs_close(nvs_handle);</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="60"><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Now<sp/>open<sp/>the<sp/>NVS<sp/>again<sp/>in<sp/>read-only<sp/>mode<sp/>to<sp/>load<sp/>the<sp/>stored<sp/>values<sp/>into<sp/>memory</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/>err<sp/>=<sp/>nvs_open(<ref refid="nvs__manager_8h_1afa7779fe56b160955b535cd6a8aaf8f4" kindref="member">NAMESPACE</ref>,<sp/>NVS_READONLY,<sp/>&amp;nvs_handle);</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(err<sp/>!=<sp/>ESP_OK)<sp/>{</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGE(<ref refid="nvs__manager_8c_1afc3d101f633a076cc1ca84b85b6224b2" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>reopen<sp/>NVS<sp/>in<sp/>RO<sp/>mode:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>esp_err_to_name(err));<sp/></highlight><highlight class="comment">//<sp/>Log<sp/>the<sp/>error</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;<sp/></highlight><highlight class="comment">//<sp/>Exit<sp/>if<sp/>we<sp/>can&apos;t<sp/>open<sp/>the<sp/>namespace</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="67"><highlight class="normal"></highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Load<sp/>values<sp/>from<sp/>NVS<sp/>into<sp/>runtime<sp/>variables</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/>nvs_get_i32(nvs_handle,<sp/><ref refid="nvs__manager_8h_1af7f392a5d16adbd68edd97898cb9d268" kindref="member">KEY_OP_MIN</ref>,<sp/>&amp;<ref refid="system_8h_1a2ef5919214974cb155ce0f62aec2c46f" kindref="member">operation_minutes</ref>);</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/>nvs_get_i32(nvs_handle,<sp/><ref refid="nvs__manager_8h_1a865b7bdd57f5ed2e21d6db5fb2e807c5" kindref="member">KEY_OP_HOURS</ref>,<sp/>&amp;<ref refid="system_8h_1afefba2969f86ee117cf53a6709050a21" kindref="member">operation_hours</ref>);</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/>nvs_get_i32(nvs_handle,<sp/><ref refid="nvs__manager_8h_1a1f7972830cca2ec9a7d9c9b08c3f4e01" kindref="member">KEY_BOOT_COUNTER</ref>,<sp/>&amp;<ref refid="system_8h_1aae68550ad38d9fd2a74d96a4f6efdc54" kindref="member">boot_count</ref>);</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/>nvs_get_i32(nvs_handle,<sp/><ref refid="nvs__manager_8h_1a46fcc98b6ef274ff52db0243d4c85b83" kindref="member">KEY_SYS_LANGUAGE</ref>,<sp/>&amp;<ref refid="system_8h_1a10a3fa33bae024190264a8321128a41d" kindref="member">system_language</ref>);</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/>nvs_get_i32(nvs_handle,<sp/><ref refid="nvs__manager_8h_1a67c7496c74bd4666922f2dba06477fa9" kindref="member">KEY_SYS_COLOR</ref>,<sp/>&amp;<ref refid="system_8h_1a30436bd24c155c7ff8b58f89cc4907d9" kindref="member">system_color</ref>);</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/>nvs_get_i32(nvs_handle,<sp/><ref refid="nvs__manager_8h_1a12e0ec2872971263a8238f0b699bc548" kindref="member">KEY_MAINTENANCE_MIN</ref>,<sp/>&amp;<ref refid="system_8h_1a792282433d9feffdd90742acc4b7cf84" kindref="member">maintenance_minutes</ref>);</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/>nvs_get_i32(nvs_handle,<sp/><ref refid="nvs__manager_8h_1a4bda739bd43d6cbc49f5a4445bfab66b" kindref="member">KEY_MAINTENANCE_HOURS</ref>,<sp/>&amp;<ref refid="system_8h_1a7935be2326bd362ec59592d133232a12" kindref="member">maintenance_hours</ref>);</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/>nvs_get_i32(nvs_handle,<sp/><ref refid="nvs__manager_8h_1aea21083fbc81f818313e73efcfb49a74" kindref="member">KEY_NUMBER_OF_MAINTENANCES</ref>,<sp/>&amp;<ref refid="system_8h_1aa828b108037b528aa15a5dc2bbf20195" kindref="member">number_of_maintenances</ref>);</highlight></codeline>
<codeline lineno="77"><highlight class="normal"></highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Close<sp/>the<sp/>NVS<sp/>handle</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/>nvs_close(nvs_handle);</highlight></codeline>
<codeline lineno="80"><highlight class="normal"></highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/>ESP_LOGI(<ref refid="nvs__manager_8c_1afc3d101f633a076cc1ca84b85b6224b2" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;NVS<sp/>preferences<sp/>loaded<sp/>successfully.&quot;</highlight><highlight class="normal">);<sp/></highlight><highlight class="comment">//<sp/>Log<sp/>success<sp/>message</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="82"><highlight class="normal">}</highlight></codeline>
<codeline lineno="83"><highlight class="normal"></highlight></codeline>
<codeline lineno="84" refid="nvs__manager_8h_1aaec9f002eed7b2794c9babcfa7d3f50b" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="nvs__manager_8c_1aaec9f002eed7b2794c9babcfa7d3f50b" kindref="member">save_int_to_nvs</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*key,<sp/>int32_t<sp/>value)<sp/>{</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/>nvs_handle_t<sp/>nvs_handle;<sp/></highlight><highlight class="comment">//<sp/>Handle<sp/>for<sp/>the<sp/>NVS<sp/>namespace</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="86"><highlight class="normal"></highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Open<sp/>the<sp/>NVS<sp/>namespace<sp/>in<sp/>read-write<sp/>mode</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(nvs_open(<ref refid="nvs__manager_8h_1afa7779fe56b160955b535cd6a8aaf8f4" kindref="member">NAMESPACE</ref>,<sp/>NVS_READWRITE,<sp/>&amp;nvs_handle)<sp/>==<sp/>ESP_OK)<sp/>{</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Set<sp/>the<sp/>integer<sp/>value<sp/>in<sp/>NVS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nvs_set_i32(nvs_handle,<sp/>key,<sp/>value);</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Commit<sp/>the<sp/>changes<sp/>to<sp/>NVS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nvs_commit(nvs_handle);</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Close<sp/>the<sp/>NVS<sp/>handle</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nvs_close(nvs_handle);</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="96"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="C:/Users/Hammurabi.Sierra/Documents/GIT/AERtronic_Lite_2.0/ESP-IDF/Aertronic_Lite/main/nvs_manager.c"/>
  </compounddef>
</doxygen>
